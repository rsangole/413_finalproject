
> # data <- data.matrix(data[,-1])
> data <- dengueDF.sj %>% arrange(week_start_date) %>% select(-year,-week_start_date)

> train_data <- data[(1:nrow(data)*0.7),]

> mean <- apply(train_data, 2, mean)

> std <- apply(train_data, 2, sd)

> data <- scale(data, center = mean, scale = std)

> generator <- function(data, lookback, delay, min_index, max_index,
+                       shuffle = FALSE, batch_size = 128, step = 1) {
+     if ( .... [TRUNCATED] 

> lookback <- 1

> step <- 1

> delay <- 1

> batch_size <- 20

> train_gen <- generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 1,
+     max_index = 550,
+     shuffle = FALS .... [TRUNCATED] 

> head(data); train_gen()
     weekofyear    ndvi_ne   ndvi_nw    ndvi_se    ndvi_sw precipitation_amt_mm
[1,] -0.5978355  0.4049784 0.1054374  0.3160629  0.1827910         -0.532770957
[2,] -0.5304971  0.9143911 0.5745327 -0.3315854 -0.2104282         -0.280002829
[3,] -0.4631587 -0.5680752 0.9501958 -0.4240387  0.0624355          0.004847409
[4,] -0.3958203  0.4699560 1.8298258  0.8372800  1.2181031         -0.461315352
[5,] -0.3284818  1.1976375 2.0388544  1.2611353  1.4216209         -0.651863633
[6,] -0.2611434  1.4868073 0.9731723  1.3169666  0.2561045         -0.601796100
     reanalysis_precip_amt_kg_per_m2 reanalysis_relative_humidity_percent
[1,]                    9.268423e-05                           -1.6642160
[2,]                   -3.929512e-01                           -0.4925697
[3,]                   -1.648404e-01                            0.8785323
[4,]                   -5.058884e-01                            0.3763385
[5,]                   -5.534115e-01                            0.4122991
[6,]                   -1.539380e-01                            0.2458768
     reanalysis_sat_precip_amt_mm reanalysis_specific_humidity_g_per_kg reanalysis_tdtr_k
[1,]                 -0.534049081                           -1.62557530        0.40229421
[2,]                 -0.281743756                           -0.74604526       -0.13015401
[3,]                  0.002584936                            0.20831874       -0.27805629
[4,]                 -0.462724306                            0.09468198       -0.01183218
[5,]                 -0.652923705                            0.44205939        1.20096654
[6,]                 -0.602947843                            0.44390715       -0.69218269
     station_avg_temp_c station_diur_temp_rng_c station_max_temp_c station_min_temp_c
[1,]         -1.1935637              0.05273461        -1.42876272         -1.7655284
[2,]         -0.2618076             -0.58649243        -0.02236631         -0.2813879
[3,]         -0.2618076             -0.44828118         0.28337204          0.1233778
[4,]          0.2930584             -0.10275304         0.95599640          0.4606824
[5,]          1.3713828              3.04155296         1.99550679          0.8654480
[6,]          0.7641710              0.10456383         1.62862077          0.8654480
     station_precip_mm reanalysis_air_temp_c reanalysis_avg_temp_c reanalysis_dew_point_temp_c
[1,]        -0.3232962           -1.24298539           -1.21316293                  -1.7080104
[2,]        -0.5794526           -0.70048889           -0.60676015                  -0.7249596
[3,]         0.5559435           -0.21624705           -0.22930536                   0.2233737
[4,]        -0.7386850           -0.04148308            0.07389603                   0.1438891
[5,]        -0.6763767            0.40999052            0.45135082                   0.4709637
[6,]         0.4763273            0.50465433            0.53797979                   0.4901496
     reanalysis_max_air_temp_c reanalysis_min_air_temp_c total_cases
[1,]                -1.2215033               -1.05085194  -0.6161365
[2,]                -0.3052199               -0.65276971  -0.5988604
[3,]                -0.6384139                0.06377831  -0.6161365
[4,]                 0.1112725               -0.17507103  -0.6334126
[5,]                 0.5277650                0.22301120  -0.5815844
[6,]                 0.9442574                0.70070988  -0.6506886
[[1]]
, , 1

              [,1]
 [1,] -0.597835523
 [2,] -0.530497104
 [3,] -0.463158685
 [4,] -0.395820266
 [5,] -0.328481848
 [6,] -0.261143429
 [7,] -0.193805010
 [8,] -0.126466592
 [9,] -0.059128173
[10,]  0.008210246
[11,]  0.075548664
[12,]  0.142887083
[13,]  0.210225502
[14,]  0.277563920
[15,]  0.344902339
[16,]  0.412240758
[17,]  0.479579177
[18,]  0.546917595
[19,]  0.614256014
[20,]  0.681594433

, , 2

            [,1]
 [1,]  0.4049784
 [2,]  0.9143911
 [3,] -0.5680752
 [4,]  0.4699560
 [5,]  1.1976375
 [6,]  1.4868073
 [7,]  0.3005111
 [8,] -0.1345898
 [9,]  0.1879665
[10,]  0.3005111
[11,]  1.1618278
[12,]  2.2250787
[13,]  0.7061749
[14,]  2.3424698
[15,] -0.8168581
[16,]  0.3785924
[17,]  1.1333772
[18,]  1.8082865
[19,]  1.6198146
[20,]  0.4627768

, , 3

             [,1]
 [1,]  0.10543738
 [2,]  0.57453273
 [3,]  0.95019575
 [4,]  1.82982578
 [5,]  2.03885442
 [6,]  0.97317227
 [7,] -0.02784914
 [8,] -0.27551196
 [9,]  0.62333329
[10,]  0.32290486
[11,] -0.15534059
[12,]  1.42396741
[13,]  0.93474184
[14,]  1.85524233
[15,] -0.37514647
[16,]  0.40200202
[17,]  0.89936143
[18,]  2.87517395
[19,]  1.28031078
[20,]  4.17265874

, , 4

            [,1]
 [1,]  0.3160629
 [2,] -0.3315854
 [3,] -0.4240387
 [4,]  0.8372800
 [5,]  1.2611353
 [6,]  1.3169666
 [7,]  0.4341703
 [8,] -0.5267375
 [9,] -0.9910567
[10,] -0.3615922
[11,]  0.1988106
[12,]  2.1575045
[13,]  0.8254999
[14,]  3.5648041
[15,] -0.2941924
[16,]  0.4679759
[17,] -0.2365702
[18,]  1.4936786
[19,]  1.8458674
[20,] -1.0299842

, , 5

             [,1]
 [1,]  0.18279104
 [2,] -0.21042820
 [3,]  0.06243550
 [4,]  1.21810313
 [5,]  1.42162087
 [6,]  0.25610455
 [7,]  0.76299330
 [8,] -0.60944151
 [9,] -0.77696702
[10,]  0.62609772
[11,] -0.25586224
[12,]  2.01376309
[13,]  0.83914077
[14,]  3.80281024
[15,] -0.50588188
[16,]  0.01623921
[17,]  0.08807089
[18,]  2.07857293
[19,]  1.12139653
[20,] -0.33839902

, , 6

              [,1]
 [1,] -0.532770957
 [2,] -0.280002829
 [3,]  0.004847409
 [4,] -0.461315352
 [5,] -0.651863633
 [6,] -0.601796100
 [7,] -0.750054329
 [8,]  2.838280912
 [9,] -0.365069026
[10,] -0.484404748
[11,] -0.293370374
[12,]  0.603470390
[13,] -0.434094169
[14,] -0.040845292
[15,] -0.134661155
[16,]  1.371010534
[17,] -0.047164495
[18,]  0.160397026
[19,] -0.133202877
[20,]  0.734472334

, , 7

               [,1]
 [1,]  9.268423e-05
 [2,] -3.929512e-01
 [3,] -1.648404e-01
 [4,] -5.058884e-01
 [5,] -5.534115e-01
 [6,] -1.539380e-01
 [7,]  1.845941e-01
 [8,] -5.581683e-02
 [9,]  1.541234e-01
[10,] -1.005444e-01
[11,]  3.277225e-01
[12,]  2.488900e-01
[13,]  2.944563e-01
[14,]  7.277506e-02
[15,] -3.353644e-01
[16,]  1.954130e+00
[17,] -1.704313e-01
[18,]  2.181398e-01
[19,] -4.463493e-02
[20,] -2.185135e-01

, , 8

            [,1]
 [1,] -1.6642160
 [2,] -0.4925697
 [3,]  0.8785323
 [4,]  0.3763385
 [5,]  0.4122991
 [6,]  0.2458768
 [7,]  0.8630609
 [8,]  1.2657359
 [9,]  1.0880236
[10,]  0.6527332
[11,]  0.7070923
[12,]  0.9052937
[13,]  0.4950920
[14,]  0.4486778
[15,]  0.1752100
[16,]  1.5007341
[17,]  0.5548870
[18,]  1.2577911
[19,] -0.5498558
[20,]  0.7317629

, , 9

              [,1]
 [1,] -0.534049081
 [2,] -0.281743756
 [3,]  0.002584936
 [4,] -0.462724306
 [5,] -0.652923705
 [6,] -0.602947843
 [7,] -0.750934619
 [8,]  2.830830582
 [9,] -0.366654202
[10,] -0.485771427
[11,] -0.295086827
[12,]  0.600111873
[13,] -0.435552964
[14,] -0.043024103
[15,] -0.136668195
[16,]  1.366246694
[17,] -0.049331736
[18,]  0.157849751
[19,] -0.135212587
[20,]  0.730873959

, , 10

             [,1]
 [1,] -1.62557530
 [2,] -0.74604526
 [3,]  0.20831874
 [4,]  0.09468198
 [5,]  0.44205939
 [6,]  0.44390715
 [7,]  0.45776529
 [8,]  0.93818086
 [9,]  0.81715309
[10,]  0.99915668
[11,]  0.57694530
[12,]  0.78296967
[13,]  0.52705600
[14,]  0.69058206
[15,]  0.92062721
[16,]  1.28648214
[17,]  1.06567576
[18,]  1.28648214
[19,]  0.66840904
[20,]  1.45555147

, , 11

             [,1]
 [1,]  0.40229421
 [2,] -0.13015401
 [3,] -0.27805629
 [4,] -0.01183218
 [5,]  1.20096654
 [6,] -0.69218269
 [7,] -0.81050451
 [8,] -1.78665959
 [9,] -1.13588954
[10,] -0.86966543
[11,] -0.57386086
[12,] -0.04141264
[13,] -0.75134360
[14,]  0.31355284
[15,] -0.21889538
[16,] -1.19505045
[17,]  0.10648964
[18,] -1.10630908
[19,]  2.14754116
[20,]  0.96432289

, , 12

            [,1]
 [1,] -1.1935637
 [2,] -0.2618076
 [3,] -0.2618076
 [4,]  0.2930584
 [5,]  1.3713828
 [6,]  0.7641710
 [7,]  0.2511817
 [8,]  0.9526160
 [9,]  0.9212085
[10,]  0.9212085
[11,]  0.3558734
[12,]  0.7746402
[13,]  0.7641710
[14,]  0.8583935
[15,]  0.8269860
[16,]  0.7118251
[17,]  0.9316777
[18,]  1.1619994
[19,]  0.9212085
[20,]  1.1829378

, , 13

             [,1]
 [1,]  0.05273461
 [2,] -0.58649243
 [3,] -0.44828118
 [4,] -0.10275304
 [5,]  3.04155296
 [6,]  0.10456383
 [7,] -0.10275304
 [8,]  1.00293698
 [9,]  0.64013244
[10,] -0.41372836
[11,]  0.36370993
[12,]  0.05273461
[13,] -0.60376884
[14,]  1.48667636
[15,]  0.84744932
[16,] -0.20641148
[17,]  0.19094587
[18,] -0.39645196
[19,]  0.91655494
[20,]  1.45212355

, , 14

             [,1]
 [1,] -1.42876272
 [2,] -0.02236631
 [3,]  0.28337204
 [4,]  0.95599640
 [5,]  1.99550679
 [6,]  1.62862077
 [7,]  0.28337204
 [8,]  1.32288242
 [9,]  1.32288242
[10,]  1.32288242
[11,] -0.02236631
[12,]  0.65025805
[13,] -0.02236631
[14,]  1.62862077
[15,]  0.95599640
[16,]  0.65025805
[17,]  0.95599640
[18,]  0.28337204
[19,]  0.65025805
[20,]  1.32288242

, , 15

            [,1]
 [1,] -1.7655284
 [2,] -0.2813879
 [3,]  0.1233778
 [4,]  0.4606824
 [5,]  0.8654480
 [6,]  0.8654480
 [7,]  0.4606824
 [8,]  0.1233778
 [9,]  0.1233778
[10,]  1.2027527
[11,] -0.6186925
[12,]  0.8654480
[13,]  0.1233778
[14,]  0.1233778
[15,]  0.4606824
[16,]  0.1233778
[17,]  0.4606824
[18,]  1.2027527
[19,]  0.4606824
[20,]  1.2027527

, , 16

             [,1]
 [1,] -0.32329616
 [2,] -0.57945260
 [3,]  0.55594351
 [4,] -0.73868498
 [5,] -0.67637665
 [6,]  0.47632732
 [7,]  0.15093941
 [8,] -0.14675591
 [9,] -0.14675591
[10,] -0.83907061
[11,]  1.32787441
[12,] -0.45483595
[13,]  0.25132505
[14,]  0.42440372
[15,] -0.48252854
[16,]  0.67017544
[17,] -0.69022295
[18,] -0.40291235
[19,] -0.38560448
[20,]  0.01939962

, , 17

             [,1]
 [1,] -1.24298539
 [2,] -0.70048889
 [3,] -0.21624705
 [4,] -0.04148308
 [5,]  0.40999052
 [6,]  0.50465433
 [7,]  0.14541728
 [8,]  0.47188609
 [9,]  0.46096334
[10,]  0.95005974
[11,]  0.40513596
[12,]  0.53620894
[13,]  0.44397240
[14,]  0.70247744
[15,]  1.15152376
[16,]  0.78379124
[17,]  1.10176457
[18,]  0.91971877
[19,]  1.26924671
[20,]  1.39182422

, , 18

             [,1]
 [1,] -1.21316293
 [2,] -0.60676015
 [3,] -0.22930536
 [4,]  0.07389603
 [5,]  0.45135082
 [6,]  0.53797979
 [7,]  0.06770825
 [8,]  0.33378294
 [9,]  0.35853407
[10,]  0.98350020
[11,]  0.38947299
[12,]  0.52560422
[13,]  0.42659969
[14,]  0.69886216
[15,]  1.15675814
[16,]  0.70504995
[17,]  1.10106809
[18,]  0.93399793
[19,]  1.29288937
[20,]  1.42902061

, , 19

            [,1]
 [1,] -1.7080104
 [2,] -0.7249596
 [3,]  0.2233737
 [4,]  0.1438891
 [5,]  0.4709637
 [6,]  0.4901496
 [7,]  0.4992858
 [8,]  0.9250308
 [9,]  0.8272739
[10,]  1.0017745
[11,]  0.6116605
[12,]  0.7989518
[13,]  0.5595844
[14,]  0.6957132
[15,]  0.9259444
[16,]  1.2475372
[17,]  1.0511098
[18,]  1.2356602
[19,]  0.6600822
[20,]  1.3480350

, , 20

             [,1]
 [1,] -1.22150327
 [2,] -0.30521991
 [3,] -0.63841386
 [4,]  0.11127252
 [5,]  0.52776496
 [6,]  0.94425740
 [7,]  0.02797404
 [8,] -0.55511537
 [9,]  0.69436194
[10,]  0.86095891
[11,]  0.44446647
[12,]  0.61106345
[13,]  0.44446647
[14,]  1.44404832
[15,]  1.02755589
[16,]  1.11085437
[17,]  1.02755589
[18,]  0.77766042
[19,]  2.11043622
[20,]  1.36074984

, , 21

             [,1]
 [1,] -1.05085194
 [2,] -0.65276971
 [3,]  0.06377831
 [4,] -0.17507103
 [5,]  0.22301120
 [6,]  0.70070988
 [7,]  0.38224410
 [8,]  0.93955922
 [9,]  0.38224410
[10,]  1.17840856
[11,]  0.62109344
[12,]  0.06377831
[13,] -0.09545458
[14,]  0.85994277
[15,]  1.25802501
[16,]  1.01917567
[17,]  0.70070988
[18,]  1.17840856
[19,]  0.62109344
[20,]  1.41725790


[[2]]
 [1] -0.616136502 -0.633412566 -0.581584374 -0.650688630 -0.616136502 -0.598860438 -0.512480118
 [8] -0.581584374 -0.547032246 -0.650688630 -0.581584374 -0.391547670 -0.287891287 -0.460651926
[15] -0.322443414 -0.201510967 -0.270615223 -0.339719478  0.005801801 -0.218787031


> val_gen = generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 551,
+     max_index = 700,
+     step = step,
+  .... [TRUNCATED] 

> test_gen <- generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 701,
+     max_index = NULL,
+     step = step, .... [TRUNCATED] 

> # How many steps to draw from val_gen in order to see the entire validation set
> val_steps <- (701 - 551 - lookback) / batch_size

> val_steps
[1] 7.45

> # How many steps to draw from test_gen in order to see the entire test set
> test_steps <- (nrow(data) - 701 - lookback) / batch_size

> test_steps
[1] 11.7

> model <- keras_model_sequential() %>%
+     layer_gru(units = 32,
+               input_shape = list(NULL, (dim(data)[[-1]]-1)),
+               dro .... [TRUNCATED] 

> model %>% compile(
+     optimizer = optimizer_rmsprop(),
+     loss = "mae"
+ )

> # tensorboard("logs/run_c", reload_interval = 10)
> history <- model %>% fit_generator(
+     train_gen,
+     steps_per_epoch = 200,
+     epochs = .... [TRUNCATED] 

> # plot(history)
