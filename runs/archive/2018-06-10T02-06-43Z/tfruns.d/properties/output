
> # data <- data.matrix(data[,-1])
> data <- dengueDF.sj %>% arrange(week_start_date) %>% select(-year,-week_start_date)

> train_data <- data[(1:nrow(data)*0.7),]

> mean <- apply(train_data, 2, mean)

> std <- apply(train_data, 2, sd)

> data <- scale(data, center = mean, scale = std)

> generator <- function(data, lookback, delay, min_index, max_index,
+                       shuffle = FALSE, batch_size = 128, step = 1) {
+     if ( .... [TRUNCATED] 

> # lookback <- 1440
> # step <- 6
> # delay <- 144
> # batch_size <- 128
> 
> lookback <- 7

> step <- 1

> delay <- 1

> batch_size <- 10

> train_gen <- generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 1,
+     max_index = 500,
+     shuffle = FALS .... [TRUNCATED] 

> head(data); train_gen()
     weekofyear    ndvi_ne   ndvi_nw    ndvi_se    ndvi_sw precipitation_amt_mm
[1,] -0.5978355  0.4049784 0.1054374  0.3160629  0.1827910         -0.532770957
[2,] -0.5304971  0.9143911 0.5745327 -0.3315854 -0.2104282         -0.280002829
[3,] -0.4631587 -0.5680752 0.9501958 -0.4240387  0.0624355          0.004847409
[4,] -0.3958203  0.4699560 1.8298258  0.8372800  1.2181031         -0.461315352
[5,] -0.3284818  1.1976375 2.0388544  1.2611353  1.4216209         -0.651863633
[6,] -0.2611434  1.4868073 0.9731723  1.3169666  0.2561045         -0.601796100
     reanalysis_precip_amt_kg_per_m2 reanalysis_relative_humidity_percent
[1,]                    9.268423e-05                           -1.6642160
[2,]                   -3.929512e-01                           -0.4925697
[3,]                   -1.648404e-01                            0.8785323
[4,]                   -5.058884e-01                            0.3763385
[5,]                   -5.534115e-01                            0.4122991
[6,]                   -1.539380e-01                            0.2458768
     reanalysis_sat_precip_amt_mm reanalysis_specific_humidity_g_per_kg reanalysis_tdtr_k
[1,]                 -0.534049081                           -1.62557530        0.40229421
[2,]                 -0.281743756                           -0.74604526       -0.13015401
[3,]                  0.002584936                            0.20831874       -0.27805629
[4,]                 -0.462724306                            0.09468198       -0.01183218
[5,]                 -0.652923705                            0.44205939        1.20096654
[6,]                 -0.602947843                            0.44390715       -0.69218269
     station_avg_temp_c station_diur_temp_rng_c station_max_temp_c station_min_temp_c
[1,]         -1.1935637              0.05273461        -1.42876272         -1.7655284
[2,]         -0.2618076             -0.58649243        -0.02236631         -0.2813879
[3,]         -0.2618076             -0.44828118         0.28337204          0.1233778
[4,]          0.2930584             -0.10275304         0.95599640          0.4606824
[5,]          1.3713828              3.04155296         1.99550679          0.8654480
[6,]          0.7641710              0.10456383         1.62862077          0.8654480
     station_precip_mm reanalysis_air_temp_c reanalysis_avg_temp_c reanalysis_dew_point_temp_c
[1,]        -0.3232962           -1.24298539           -1.21316293                  -1.7080104
[2,]        -0.5794526           -0.70048889           -0.60676015                  -0.7249596
[3,]         0.5559435           -0.21624705           -0.22930536                   0.2233737
[4,]        -0.7386850           -0.04148308            0.07389603                   0.1438891
[5,]        -0.6763767            0.40999052            0.45135082                   0.4709637
[6,]         0.4763273            0.50465433            0.53797979                   0.4901496
     reanalysis_max_air_temp_c reanalysis_min_air_temp_c total_cases
[1,]                -1.2215033               -1.05085194  -0.6161365
[2,]                -0.3052199               -0.65276971  -0.5988604
[3,]                -0.6384139                0.06377831  -0.6161365
[4,]                 0.1112725               -0.17507103  -0.6334126
[5,]                 0.5277650                0.22301120  -0.5815844
[6,]                 0.9442574                0.70070988  -0.6506886
[[1]]
, , 1

              [,1]         [,2]         [,3]         [,4]         [,5]         [,6]         [,7]
 [1,] -0.597835523 -0.530497104 -0.463158685 -0.395820266 -0.328481848 -0.261143429 -0.193805010
 [2,] -0.530497104 -0.463158685 -0.395820266 -0.328481848 -0.261143429 -0.193805010 -0.126466592
 [3,] -0.463158685 -0.395820266 -0.328481848 -0.261143429 -0.193805010 -0.126466592 -0.059128173
 [4,] -0.395820266 -0.328481848 -0.261143429 -0.193805010 -0.126466592 -0.059128173  0.008210246
 [5,] -0.328481848 -0.261143429 -0.193805010 -0.126466592 -0.059128173  0.008210246  0.075548664
 [6,] -0.261143429 -0.193805010 -0.126466592 -0.059128173  0.008210246  0.075548664  0.142887083
 [7,] -0.193805010 -0.126466592 -0.059128173  0.008210246  0.075548664  0.142887083  0.210225502
 [8,] -0.126466592 -0.059128173  0.008210246  0.075548664  0.142887083  0.210225502  0.277563920
 [9,] -0.059128173  0.008210246  0.075548664  0.142887083  0.210225502  0.277563920  0.344902339
[10,]  0.008210246  0.075548664  0.142887083  0.210225502  0.277563920  0.344902339  0.412240758

, , 2

            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]
 [1,]  0.4049784  0.9143911 -0.5680752  0.4699560  1.1976375  1.4868073  0.3005111
 [2,]  0.9143911 -0.5680752  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898
 [3,] -0.5680752  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665
 [4,]  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111
 [5,]  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278
 [6,]  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787
 [7,]  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749
 [8,] -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698
 [9,]  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698 -0.8168581
[10,]  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698 -0.8168581  0.3785924

, , 3

             [,1]        [,2]        [,3]        [,4]        [,5]        [,6]        [,7]
 [1,]  0.10543738  0.57453273  0.95019575  1.82982578  2.03885442  0.97317227 -0.02784914
 [2,]  0.57453273  0.95019575  1.82982578  2.03885442  0.97317227 -0.02784914 -0.27551196
 [3,]  0.95019575  1.82982578  2.03885442  0.97317227 -0.02784914 -0.27551196  0.62333329
 [4,]  1.82982578  2.03885442  0.97317227 -0.02784914 -0.27551196  0.62333329  0.32290486
 [5,]  2.03885442  0.97317227 -0.02784914 -0.27551196  0.62333329  0.32290486 -0.15534059
 [6,]  0.97317227 -0.02784914 -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741
 [7,] -0.02784914 -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184
 [8,] -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233
 [9,]  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647
[10,]  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647  0.40200202

, , 4

            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]
 [1,]  0.3160629 -0.3315854 -0.4240387  0.8372800  1.2611353  1.3169666  0.4341703
 [2,] -0.3315854 -0.4240387  0.8372800  1.2611353  1.3169666  0.4341703 -0.5267375
 [3,] -0.4240387  0.8372800  1.2611353  1.3169666  0.4341703 -0.5267375 -0.9910567
 [4,]  0.8372800  1.2611353  1.3169666  0.4341703 -0.5267375 -0.9910567 -0.3615922
 [5,]  1.2611353  1.3169666  0.4341703 -0.5267375 -0.9910567 -0.3615922  0.1988106
 [6,]  1.3169666  0.4341703 -0.5267375 -0.9910567 -0.3615922  0.1988106  2.1575045
 [7,]  0.4341703 -0.5267375 -0.9910567 -0.3615922  0.1988106  2.1575045  0.8254999
 [8,] -0.5267375 -0.9910567 -0.3615922  0.1988106  2.1575045  0.8254999  3.5648041
 [9,] -0.9910567 -0.3615922  0.1988106  2.1575045  0.8254999  3.5648041 -0.2941924
[10,] -0.3615922  0.1988106  2.1575045  0.8254999  3.5648041 -0.2941924  0.4679759

, , 5

            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]        [,7]
 [1,]  0.1827910 -0.2104282  0.0624355  1.2181031  1.4216209  0.2561045  0.76299330
 [2,] -0.2104282  0.0624355  1.2181031  1.4216209  0.2561045  0.7629933 -0.60944151
 [3,]  0.0624355  1.2181031  1.4216209  0.2561045  0.7629933 -0.6094415 -0.77696702
 [4,]  1.2181031  1.4216209  0.2561045  0.7629933 -0.6094415 -0.7769670  0.62609772
 [5,]  1.4216209  0.2561045  0.7629933 -0.6094415 -0.7769670  0.6260977 -0.25586224
 [6,]  0.2561045  0.7629933 -0.6094415 -0.7769670  0.6260977 -0.2558622  2.01376309
 [7,]  0.7629933 -0.6094415 -0.7769670  0.6260977 -0.2558622  2.0137631  0.83914077
 [8,] -0.6094415 -0.7769670  0.6260977 -0.2558622  2.0137631  0.8391408  3.80281024
 [9,] -0.7769670  0.6260977 -0.2558622  2.0137631  0.8391408  3.8028102 -0.50588188
[10,]  0.6260977 -0.2558622  2.0137631  0.8391408  3.8028102 -0.5058819  0.01623921

, , 6

              [,1]         [,2]         [,3]       [,4]        [,5]        [,6]        [,7]
 [1,] -0.532770957 -0.280002829  0.004847409 -0.4613154 -0.65186363 -0.60179610 -0.75005433
 [2,] -0.280002829  0.004847409 -0.461315352 -0.6518636 -0.60179610 -0.75005433  2.83828091
 [3,]  0.004847409 -0.461315352 -0.651863633 -0.6017961 -0.75005433  2.83828091 -0.36506903
 [4,] -0.461315352 -0.651863633 -0.601796100 -0.7500543  2.83828091 -0.36506903 -0.48440475
 [5,] -0.651863633 -0.601796100 -0.750054329  2.8382809 -0.36506903 -0.48440475 -0.29337037
 [6,] -0.601796100 -0.750054329  2.838280912 -0.3650690 -0.48440475 -0.29337037  0.60347039
 [7,] -0.750054329  2.838280912 -0.365069026 -0.4844047 -0.29337037  0.60347039 -0.43409417
 [8,]  2.838280912 -0.365069026 -0.484404748 -0.2933704  0.60347039 -0.43409417 -0.04084529
 [9,] -0.365069026 -0.484404748 -0.293370374  0.6034704 -0.43409417 -0.04084529 -0.13466115
[10,] -0.484404748 -0.293370374  0.603470390 -0.4340942 -0.04084529 -0.13466115  1.37101053

, , 7

               [,1]        [,2]        [,3]        [,4]        [,5]        [,6]        [,7]
 [1,]  9.268423e-05 -0.39295122 -0.16484039 -0.50588844 -0.55341153 -0.15393803  0.18459409
 [2,] -3.929512e-01 -0.16484039 -0.50588844 -0.55341153 -0.15393803  0.18459409 -0.05581683
 [3,] -1.648404e-01 -0.50588844 -0.55341153 -0.15393803  0.18459409 -0.05581683  0.15412340
 [4,] -5.058884e-01 -0.55341153 -0.15393803  0.18459409 -0.05581683  0.15412340 -0.10054445
 [5,] -5.534115e-01 -0.15393803  0.18459409 -0.05581683  0.15412340 -0.10054445  0.32772245
 [6,] -1.539380e-01  0.18459409 -0.05581683  0.15412340 -0.10054445  0.32772245  0.24889003
 [7,]  1.845941e-01 -0.05581683  0.15412340 -0.10054445  0.32772245  0.24889003  0.29445629
 [8,] -5.581683e-02  0.15412340 -0.10054445  0.32772245  0.24889003  0.29445629  0.07277506
 [9,]  1.541234e-01 -0.10054445  0.32772245  0.24889003  0.29445629  0.07277506 -0.33536442
[10,] -1.005444e-01  0.32772245  0.24889003  0.29445629  0.07277506 -0.33536442  1.95413030

, , 8

            [,1]       [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
 [1,] -1.6642160 -0.4925697 0.8785323 0.3763385 0.4122991 0.2458768 0.8630609
 [2,] -0.4925697  0.8785323 0.3763385 0.4122991 0.2458768 0.8630609 1.2657359
 [3,]  0.8785323  0.3763385 0.4122991 0.2458768 0.8630609 1.2657359 1.0880236
 [4,]  0.3763385  0.4122991 0.2458768 0.8630609 1.2657359 1.0880236 0.6527332
 [5,]  0.4122991  0.2458768 0.8630609 1.2657359 1.0880236 0.6527332 0.7070923
 [6,]  0.2458768  0.8630609 1.2657359 1.0880236 0.6527332 0.7070923 0.9052937
 [7,]  0.8630609  1.2657359 1.0880236 0.6527332 0.7070923 0.9052937 0.4950920
 [8,]  1.2657359  1.0880236 0.6527332 0.7070923 0.9052937 0.4950920 0.4486778
 [9,]  1.0880236  0.6527332 0.7070923 0.9052937 0.4950920 0.4486778 0.1752100
[10,]  0.6527332  0.7070923 0.9052937 0.4950920 0.4486778 0.1752100 1.5007341

, , 9

              [,1]         [,2]         [,3]       [,4]       [,5]       [,6]       [,7]
 [1,] -0.534049081 -0.281743756  0.002584936 -0.4627243 -0.6529237 -0.6029478 -0.7509346
 [2,] -0.281743756  0.002584936 -0.462724306 -0.6529237 -0.6029478 -0.7509346  2.8308306
 [3,]  0.002584936 -0.462724306 -0.652923705 -0.6029478 -0.7509346  2.8308306 -0.3666542
 [4,] -0.462724306 -0.652923705 -0.602947843 -0.7509346  2.8308306 -0.3666542 -0.4857714
 [5,] -0.652923705 -0.602947843 -0.750934619  2.8308306 -0.3666542 -0.4857714 -0.2950868
 [6,] -0.602947843 -0.750934619  2.830830582 -0.3666542 -0.4857714 -0.2950868  0.6001119
 [7,] -0.750934619  2.830830582 -0.366654202 -0.4857714 -0.2950868  0.6001119 -0.4355530
 [8,]  2.830830582 -0.366654202 -0.485771427 -0.2950868  0.6001119 -0.4355530 -0.0430241
 [9,] -0.366654202 -0.485771427 -0.295086827  0.6001119 -0.4355530 -0.0430241 -0.1366682
[10,] -0.485771427 -0.295086827  0.600111873 -0.4355530 -0.0430241 -0.1366682  1.3662467

, , 10

             [,1]        [,2]       [,3]       [,4]      [,5]      [,6]      [,7]
 [1,] -1.62557530 -0.74604526 0.20831874 0.09468198 0.4420594 0.4439071 0.4577653
 [2,] -0.74604526  0.20831874 0.09468198 0.44205939 0.4439071 0.4577653 0.9381809
 [3,]  0.20831874  0.09468198 0.44205939 0.44390715 0.4577653 0.9381809 0.8171531
 [4,]  0.09468198  0.44205939 0.44390715 0.45776529 0.9381809 0.8171531 0.9991567
 [5,]  0.44205939  0.44390715 0.45776529 0.93818086 0.8171531 0.9991567 0.5769453
 [6,]  0.44390715  0.45776529 0.93818086 0.81715309 0.9991567 0.5769453 0.7829697
 [7,]  0.45776529  0.93818086 0.81715309 0.99915668 0.5769453 0.7829697 0.5270560
 [8,]  0.93818086  0.81715309 0.99915668 0.57694530 0.7829697 0.5270560 0.6905821
 [9,]  0.81715309  0.99915668 0.57694530 0.78296967 0.5270560 0.6905821 0.9206272
[10,]  0.99915668  0.57694530 0.78296967 0.52705600 0.6905821 0.9206272 1.2864821

, , 11

             [,1]        [,2]        [,3]        [,4]        [,5]        [,6]        [,7]
 [1,]  0.40229421 -0.13015401 -0.27805629 -0.01183218  1.20096654 -0.69218269 -0.81050451
 [2,] -0.13015401 -0.27805629 -0.01183218  1.20096654 -0.69218269 -0.81050451 -1.78665959
 [3,] -0.27805629 -0.01183218  1.20096654 -0.69218269 -0.81050451 -1.78665959 -1.13588954
 [4,] -0.01183218  1.20096654 -0.69218269 -0.81050451 -1.78665959 -1.13588954 -0.86966543
 [5,]  1.20096654 -0.69218269 -0.81050451 -1.78665959 -1.13588954 -0.86966543 -0.57386086
 [6,] -0.69218269 -0.81050451 -1.78665959 -1.13588954 -0.86966543 -0.57386086 -0.04141264
 [7,] -0.81050451 -1.78665959 -1.13588954 -0.86966543 -0.57386086 -0.04141264 -0.75134360
 [8,] -1.78665959 -1.13588954 -0.86966543 -0.57386086 -0.04141264 -0.75134360  0.31355284
 [9,] -1.13588954 -0.86966543 -0.57386086 -0.04141264 -0.75134360  0.31355284 -0.21889538
[10,] -0.86966543 -0.57386086 -0.04141264 -0.75134360  0.31355284 -0.21889538 -1.19505045

, , 12

            [,1]       [,2]       [,3]      [,4]      [,5]      [,6]      [,7]
 [1,] -1.1935637 -0.2618076 -0.2618076 0.2930584 1.3713828 0.7641710 0.2511817
 [2,] -0.2618076 -0.2618076  0.2930584 1.3713828 0.7641710 0.2511817 0.9526160
 [3,] -0.2618076  0.2930584  1.3713828 0.7641710 0.2511817 0.9526160 0.9212085
 [4,]  0.2930584  1.3713828  0.7641710 0.2511817 0.9526160 0.9212085 0.9212085
 [5,]  1.3713828  0.7641710  0.2511817 0.9526160 0.9212085 0.9212085 0.3558734
 [6,]  0.7641710  0.2511817  0.9526160 0.9212085 0.9212085 0.3558734 0.7746402
 [7,]  0.2511817  0.9526160  0.9212085 0.9212085 0.3558734 0.7746402 0.7641710
 [8,]  0.9526160  0.9212085  0.9212085 0.3558734 0.7746402 0.7641710 0.8583935
 [9,]  0.9212085  0.9212085  0.3558734 0.7746402 0.7641710 0.8583935 0.8269860
[10,]  0.9212085  0.3558734  0.7746402 0.7641710 0.8583935 0.8269860 0.7118251

, , 13

             [,1]       [,2]        [,3]        [,4]        [,5]        [,6]        [,7]
 [1,]  0.05273461 -0.5864924 -0.44828118 -0.10275304  3.04155296  0.10456383 -0.10275304
 [2,] -0.58649243 -0.4482812 -0.10275304  3.04155296  0.10456383 -0.10275304  1.00293698
 [3,] -0.44828118 -0.1027530  3.04155296  0.10456383 -0.10275304  1.00293698  0.64013244
 [4,] -0.10275304  3.0415530  0.10456383 -0.10275304  1.00293698  0.64013244 -0.41372836
 [5,]  3.04155296  0.1045638 -0.10275304  1.00293698  0.64013244 -0.41372836  0.36370993
 [6,]  0.10456383 -0.1027530  1.00293698  0.64013244 -0.41372836  0.36370993  0.05273461
 [7,] -0.10275304  1.0029370  0.64013244 -0.41372836  0.36370993  0.05273461 -0.60376884
 [8,]  1.00293698  0.6401324 -0.41372836  0.36370993  0.05273461 -0.60376884  1.48667636
 [9,]  0.64013244 -0.4137284  0.36370993  0.05273461 -0.60376884  1.48667636  0.84744932
[10,] -0.41372836  0.3637099  0.05273461 -0.60376884  1.48667636  0.84744932 -0.20641148

, , 14

             [,1]        [,2]        [,3]        [,4]        [,5]        [,6]        [,7]
 [1,] -1.42876272 -0.02236631  0.28337204  0.95599640  1.99550679  1.62862077  0.28337204
 [2,] -0.02236631  0.28337204  0.95599640  1.99550679  1.62862077  0.28337204  1.32288242
 [3,]  0.28337204  0.95599640  1.99550679  1.62862077  0.28337204  1.32288242  1.32288242
 [4,]  0.95599640  1.99550679  1.62862077  0.28337204  1.32288242  1.32288242  1.32288242
 [5,]  1.99550679  1.62862077  0.28337204  1.32288242  1.32288242  1.32288242 -0.02236631
 [6,]  1.62862077  0.28337204  1.32288242  1.32288242  1.32288242 -0.02236631  0.65025805
 [7,]  0.28337204  1.32288242  1.32288242  1.32288242 -0.02236631  0.65025805 -0.02236631
 [8,]  1.32288242  1.32288242  1.32288242 -0.02236631  0.65025805 -0.02236631  1.62862077
 [9,]  1.32288242  1.32288242 -0.02236631  0.65025805 -0.02236631  1.62862077  0.95599640
[10,]  1.32288242 -0.02236631  0.65025805 -0.02236631  1.62862077  0.95599640  0.65025805

, , 15

            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]
 [1,] -1.7655284 -0.2813879  0.1233778  0.4606824  0.8654480  0.8654480  0.4606824
 [2,] -0.2813879  0.1233778  0.4606824  0.8654480  0.8654480  0.4606824  0.1233778

 [ reached getOption("max.print") -- omitted 8 row(s) and 6 matrix slice(s) ]

[[2]]
 [1] -0.5124801 -0.5815844 -0.5470322 -0.6506886 -0.5815844 -0.3915477 -0.2878913 -0.4606519
 [9] -0.3224434 -0.2015110


> val_gen = generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 501,
+     max_index = 700,
+     step = step,
+  .... [TRUNCATED] 

> test_gen <- generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 701,
+     max_index = NULL,
+     step = step, .... [TRUNCATED] 

> # How many steps to draw from val_gen in order to see the entire validation set
> val_steps <- (701 - 501 - lookback) / batch_size

> val_steps
[1] 19.3

> # How many steps to draw from test_gen in order to see the entire test set
> test_steps <- (nrow(data) - 701 - lookback) / batch_size

> test_steps
[1] 22.8

> model <- keras_model_sequential() %>%
+     layer_gru(units = 50, input_shape = list(NULL, (dim(data)[[-1]]-1)),
+               dropout = 0.2, recu .... [TRUNCATED] 

> model %>% compile(
+     optimizer = optimizer_rmsprop(),
+     loss = "mae"
+ )

> tensorboard("logs/run_c", reload_interval = 10)
Started TensorBoard at http://127.0.0.1:5545 

> history <- model %>% fit_generator(
+     train_gen,
+     steps_per_epoch = 200,
+     epochs = 30,
+     validation_data = val_gen,
+     validati .... [TRUNCATED] 

> plot(history)

> model %>% evaluate(test_gen())
