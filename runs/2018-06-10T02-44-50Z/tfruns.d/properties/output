
> # data <- data.matrix(data[,-1])
> data <- dengueDF.sj %>% arrange(week_start_date) %>% select(-year,-week_start_date)

> train_data <- data[(1:nrow(data)*0.7),]

> mean <- apply(train_data, 2, mean)

> std <- apply(train_data, 2, sd)

> data <- scale(data, center = mean, scale = std)

> generator <- function(data, lookback, delay, min_index, max_index,
+                       shuffle = FALSE, batch_size = 128, step = 1) {
+     if ( .... [TRUNCATED] 

> lookback <- 14

> step <- 1

> delay <- 1

> batch_size <- 30

> train_gen <- generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 1,
+     max_index = 500,
+     shuffle = FALS .... [TRUNCATED] 

> head(data); train_gen()
     weekofyear    ndvi_ne   ndvi_nw    ndvi_se    ndvi_sw precipitation_amt_mm
[1,] -0.5978355  0.4049784 0.1054374  0.3160629  0.1827910         -0.532770957
[2,] -0.5304971  0.9143911 0.5745327 -0.3315854 -0.2104282         -0.280002829
[3,] -0.4631587 -0.5680752 0.9501958 -0.4240387  0.0624355          0.004847409
[4,] -0.3958203  0.4699560 1.8298258  0.8372800  1.2181031         -0.461315352
[5,] -0.3284818  1.1976375 2.0388544  1.2611353  1.4216209         -0.651863633
[6,] -0.2611434  1.4868073 0.9731723  1.3169666  0.2561045         -0.601796100
     reanalysis_precip_amt_kg_per_m2 reanalysis_relative_humidity_percent
[1,]                    9.268423e-05                           -1.6642160
[2,]                   -3.929512e-01                           -0.4925697
[3,]                   -1.648404e-01                            0.8785323
[4,]                   -5.058884e-01                            0.3763385
[5,]                   -5.534115e-01                            0.4122991
[6,]                   -1.539380e-01                            0.2458768
     reanalysis_sat_precip_amt_mm reanalysis_specific_humidity_g_per_kg reanalysis_tdtr_k
[1,]                 -0.534049081                           -1.62557530        0.40229421
[2,]                 -0.281743756                           -0.74604526       -0.13015401
[3,]                  0.002584936                            0.20831874       -0.27805629
[4,]                 -0.462724306                            0.09468198       -0.01183218
[5,]                 -0.652923705                            0.44205939        1.20096654
[6,]                 -0.602947843                            0.44390715       -0.69218269
     station_avg_temp_c station_diur_temp_rng_c station_max_temp_c station_min_temp_c
[1,]         -1.1935637              0.05273461        -1.42876272         -1.7655284
[2,]         -0.2618076             -0.58649243        -0.02236631         -0.2813879
[3,]         -0.2618076             -0.44828118         0.28337204          0.1233778
[4,]          0.2930584             -0.10275304         0.95599640          0.4606824
[5,]          1.3713828              3.04155296         1.99550679          0.8654480
[6,]          0.7641710              0.10456383         1.62862077          0.8654480
     station_precip_mm reanalysis_air_temp_c reanalysis_avg_temp_c reanalysis_dew_point_temp_c
[1,]        -0.3232962           -1.24298539           -1.21316293                  -1.7080104
[2,]        -0.5794526           -0.70048889           -0.60676015                  -0.7249596
[3,]         0.5559435           -0.21624705           -0.22930536                   0.2233737
[4,]        -0.7386850           -0.04148308            0.07389603                   0.1438891
[5,]        -0.6763767            0.40999052            0.45135082                   0.4709637
[6,]         0.4763273            0.50465433            0.53797979                   0.4901496
     reanalysis_max_air_temp_c reanalysis_min_air_temp_c total_cases
[1,]                -1.2215033               -1.05085194  -0.6161365
[2,]                -0.3052199               -0.65276971  -0.5988604
[3,]                -0.6384139                0.06377831  -0.6161365
[4,]                 0.1112725               -0.17507103  -0.6334126
[5,]                 0.5277650                0.22301120  -0.5815844
[6,]                 0.9442574                0.70070988  -0.6506886
[[1]]
, , 1

              [,1]         [,2]         [,3]         [,4]         [,5]         [,6]         [,7]
 [1,] -0.597835523 -0.530497104 -0.463158685 -0.395820266 -0.328481848 -0.261143429 -0.193805010
 [2,] -0.530497104 -0.463158685 -0.395820266 -0.328481848 -0.261143429 -0.193805010 -0.126466592
 [3,] -0.463158685 -0.395820266 -0.328481848 -0.261143429 -0.193805010 -0.126466592 -0.059128173
 [4,] -0.395820266 -0.328481848 -0.261143429 -0.193805010 -0.126466592 -0.059128173  0.008210246
 [5,] -0.328481848 -0.261143429 -0.193805010 -0.126466592 -0.059128173  0.008210246  0.075548664
 [6,] -0.261143429 -0.193805010 -0.126466592 -0.059128173  0.008210246  0.075548664  0.142887083
 [7,] -0.193805010 -0.126466592 -0.059128173  0.008210246  0.075548664  0.142887083  0.210225502
 [8,] -0.126466592 -0.059128173  0.008210246  0.075548664  0.142887083  0.210225502  0.277563920
 [9,] -0.059128173  0.008210246  0.075548664  0.142887083  0.210225502  0.277563920  0.344902339
[10,]  0.008210246  0.075548664  0.142887083  0.210225502  0.277563920  0.344902339  0.412240758
[11,]  0.075548664  0.142887083  0.210225502  0.277563920  0.344902339  0.412240758  0.479579177
[12,]  0.142887083  0.210225502  0.277563920  0.344902339  0.412240758  0.479579177  0.546917595
[13,]  0.210225502  0.277563920  0.344902339  0.412240758  0.479579177  0.546917595  0.614256014
[14,]  0.277563920  0.344902339  0.412240758  0.479579177  0.546917595  0.614256014  0.681594433
[15,]  0.344902339  0.412240758  0.479579177  0.546917595  0.614256014  0.681594433  0.748932851
[16,]  0.412240758  0.479579177  0.546917595  0.614256014  0.681594433  0.748932851  0.816271270
[17,]  0.479579177  0.546917595  0.614256014  0.681594433  0.748932851  0.816271270  0.883609689
[18,]  0.546917595  0.614256014  0.681594433  0.748932851  0.816271270  0.883609689  0.950948107
[19,]  0.614256014  0.681594433  0.748932851  0.816271270  0.883609689  0.950948107  1.018286526
[20,]  0.681594433  0.748932851  0.816271270  0.883609689  0.950948107  1.018286526  1.085624945
[21,]  0.748932851  0.816271270  0.883609689  0.950948107  1.018286526  1.085624945  1.152963364
[22,]  0.816271270  0.883609689  0.950948107  1.018286526  1.085624945  1.152963364  1.220301782
[23,]  0.883609689  0.950948107  1.018286526  1.085624945  1.152963364  1.220301782  1.287640201
[24,]  0.950948107  1.018286526  1.085624945  1.152963364  1.220301782  1.287640201  1.354978620
[25,]  1.018286526  1.085624945  1.152963364  1.220301782  1.287640201  1.354978620  1.422317038
[26,]  1.085624945  1.152963364  1.220301782  1.287640201  1.354978620  1.422317038  1.489655457
[27,]  1.152963364  1.220301782  1.287640201  1.354978620  1.422317038  1.489655457  1.556993876
[28,]  1.220301782  1.287640201  1.354978620  1.422317038  1.489655457  1.556993876  1.624332294
[29,]  1.287640201  1.354978620  1.422317038  1.489655457  1.556993876  1.624332294  1.691670713
[30,]  1.354978620  1.422317038  1.489655457  1.556993876  1.624332294  1.691670713 -1.742588640
              [,8]         [,9]        [,10]       [,11]      [,12]      [,13]      [,14]
 [1,] -0.126466592 -0.059128173  0.008210246  0.07554866  0.1428871  0.2102255  0.2775639
 [2,] -0.059128173  0.008210246  0.075548664  0.14288708  0.2102255  0.2775639  0.3449023
 [3,]  0.008210246  0.075548664  0.142887083  0.21022550  0.2775639  0.3449023  0.4122408
 [4,]  0.075548664  0.142887083  0.210225502  0.27756392  0.3449023  0.4122408  0.4795792
 [5,]  0.142887083  0.210225502  0.277563920  0.34490234  0.4122408  0.4795792  0.5469176
 [6,]  0.210225502  0.277563920  0.344902339  0.41224076  0.4795792  0.5469176  0.6142560
 [7,]  0.277563920  0.344902339  0.412240758  0.47957918  0.5469176  0.6142560  0.6815944
 [8,]  0.344902339  0.412240758  0.479579177  0.54691760  0.6142560  0.6815944  0.7489329
 [9,]  0.412240758  0.479579177  0.546917595  0.61425601  0.6815944  0.7489329  0.8162713
[10,]  0.479579177  0.546917595  0.614256014  0.68159443  0.7489329  0.8162713  0.8836097
[11,]  0.546917595  0.614256014  0.681594433  0.74893285  0.8162713  0.8836097  0.9509481
[12,]  0.614256014  0.681594433  0.748932851  0.81627127  0.8836097  0.9509481  1.0182865
[13,]  0.681594433  0.748932851  0.816271270  0.88360969  0.9509481  1.0182865  1.0856249
[14,]  0.748932851  0.816271270  0.883609689  0.95094811  1.0182865  1.0856249  1.1529634
[15,]  0.816271270  0.883609689  0.950948107  1.01828653  1.0856249  1.1529634  1.2203018
[16,]  0.883609689  0.950948107  1.018286526  1.08562494  1.1529634  1.2203018  1.2876402
[17,]  0.950948107  1.018286526  1.085624945  1.15296336  1.2203018  1.2876402  1.3549786
[18,]  1.018286526  1.085624945  1.152963364  1.22030178  1.2876402  1.3549786  1.4223170
[19,]  1.085624945  1.152963364  1.220301782  1.28764020  1.3549786  1.4223170  1.4896555
[20,]  1.152963364  1.220301782  1.287640201  1.35497862  1.4223170  1.4896555  1.5569939
[21,]  1.220301782  1.287640201  1.354978620  1.42231704  1.4896555  1.5569939  1.6243323
[22,]  1.287640201  1.354978620  1.422317038  1.48965546  1.5569939  1.6243323  1.6916707
[23,]  1.354978620  1.422317038  1.489655457  1.55699388  1.6243323  1.6916707 -1.7425886
[24,]  1.422317038  1.489655457  1.556993876  1.62433229  1.6916707 -1.7425886 -1.6752502
[25,]  1.489655457  1.556993876  1.624332294  1.69167071 -1.7425886 -1.6752502 -1.6079118
[26,]  1.556993876  1.624332294  1.691670713 -1.74258864 -1.6752502 -1.6079118 -1.5405734
[27,]  1.624332294  1.691670713 -1.742588640 -1.67525022 -1.6079118 -1.5405734 -1.4732350
[28,]  1.691670713 -1.742588640 -1.675250222 -1.60791180 -1.5405734 -1.4732350 -1.4058965
[29,] -1.742588640 -1.675250222 -1.607911803 -1.54057338 -1.4732350 -1.4058965 -1.3385581
[30,] -1.675250222 -1.607911803 -1.540573384 -1.47323497 -1.4058965 -1.3385581 -1.2712197

, , 2

            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]       [,8]
 [1,]  0.4049784  0.9143911 -0.5680752  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898
 [2,]  0.9143911 -0.5680752  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665
 [3,] -0.5680752  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111
 [4,]  0.4699560  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278
 [5,]  1.1976375  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787
 [6,]  1.4868073  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749
 [7,]  0.3005111 -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698
 [8,] -0.1345898  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698 -0.8168581
 [9,]  0.1879665  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698 -0.8168581  0.3785924
[10,]  0.3005111  1.1618278  2.2250787  0.7061749  2.3424698 -0.8168581  0.3785924  1.1333772
[11,]  1.1618278  2.2250787  0.7061749  2.3424698 -0.8168581  0.3785924  1.1333772  1.8082865
[12,]  2.2250787  0.7061749  2.3424698 -0.8168581  0.3785924  1.1333772  1.8082865  1.6198146
[13,]  0.7061749  2.3424698 -0.8168581  0.3785924  1.1333772  1.8082865  1.6198146  0.4627768
[14,]  2.3424698 -0.8168581  0.3785924  1.1333772  1.8082865  1.6198146  0.4627768  1.1992530
[15,] -0.8168581  0.3785924  1.1333772  1.8082865  1.6198146  0.4627768  1.1992530  0.3349746
[16,]  0.3785924  1.1333772  1.8082865  1.6198146  0.4627768  1.1992530  0.3349746  1.5460413
[17,]  1.1333772  1.8082865  1.6198146  0.4627768  1.1992530  0.3349746  1.5460413  0.9278534
[18,]  1.8082865  1.6198146  0.4627768  1.1992530  0.3349746  1.5460413  0.9278534  0.2660477
[19,]  1.6198146  0.4627768  1.1992530  0.3349746  1.5460413  0.9278534  0.2660477  0.6591463
[20,]  0.4627768  1.1992530  0.3349746  1.5460413  0.9278534  0.2660477  0.6591463  1.8012861
[21,]  1.1992530  0.3349746  1.5460413  0.9278534  0.2660477  0.6591463  1.8012861  0.7280732
[22,]  0.3349746  1.5460413  0.9278534  0.2660477  0.6591463  1.8012861  0.7280732  2.2164629
[23,]  1.5460413  0.9278534  0.2660477  0.6591463  1.8012861  0.7280732  2.2164629  2.0161441
[24,]  0.9278534  0.2660477  0.6591463  1.8012861  0.7280732  2.2164629  2.0161441  0.5575513
[25,]  0.2660477  0.6591463  1.8012861  0.7280732  2.2164629  2.0161441  0.5575513  0.2671247
[26,]  0.6591463  1.8012861  0.7280732  2.2164629  2.0161441  0.5575513  0.2671247  0.3915162
[27,]  1.8012861  0.7280732  2.2164629  2.0161441  0.5575513  0.2671247  0.3915162  2.2415921
[28,]  0.7280732  2.2164629  2.0161441  0.5575513  0.2671247  0.3915162  2.2415921  2.3424698
[29,]  2.2164629  2.0161441  0.5575513  0.2671247  0.3915162  2.2415921  2.3424698  0.6623772
[30,]  2.0161441  0.5575513  0.2671247  0.3915162  2.2415921  2.3424698  0.6623772 -1.2024178
            [,9]      [,10]       [,11]       [,12]       [,13]        [,14]
 [1,]  0.1879665  0.3005111  1.16182783  2.22507873  0.70617488  2.342469814
 [2,]  0.3005111  1.1618278  2.22507873  0.70617488  2.34246981 -0.816858130
 [3,]  1.1618278  2.2250787  0.70617488  2.34246981 -0.81685813  0.378592362
 [4,]  2.2250787  0.7061749  2.34246981 -0.81685813  0.37859236  1.133377186
 [5,]  0.7061749  2.3424698 -0.81685813  0.37859236  1.13337719  1.808286531
 [6,]  2.3424698 -0.8168581  0.37859236  1.13337719  1.80828653  1.619814607
 [7,] -0.8168581  0.3785924  1.13337719  1.80828653  1.61981461  0.462776847
 [8,]  0.3785924  1.1333772  1.80828653  1.61981461  0.46277685  1.199252970
 [9,]  1.1333772  1.8082865  1.61981461  0.46277685  1.19925297  0.334974574
[10,]  1.8082865  1.6198146  0.46277685  1.19925297  0.33497457  1.546041311
[11,]  1.6198146  0.4627768  1.19925297  0.33497457  1.54604131  0.927853399
[12,]  0.4627768  1.1992530  0.33497457  1.54604131  0.92785340  0.266047699
[13,]  1.1992530  0.3349746  1.54604131  0.92785340  0.26604770  0.659146284
[14,]  0.3349746  1.5460413  0.92785340  0.26604770  0.65914628  1.801286146
[15,]  1.5460413  0.9278534  0.26604770  0.65914628  1.80128615  0.728073159
[16,]  0.9278534  0.2660477  0.65914628  1.80128615  0.72807316  2.216462870
[17,]  0.2660477  0.6591463  1.80128615  0.72807316  2.21646287  2.016144139
[18,]  0.6591463  1.8012861  0.72807316  2.21646287  2.01614414  0.557551301
[19,]  1.8012861  0.7280732  2.21646287  2.01614414  0.55755130  0.267124681
[20,]  0.7280732  2.2164629  2.01614414  0.55755130  0.26712468  0.391516151
[21,]  2.2164629  2.0161441  0.55755130  0.26712468  0.39151615  2.241592101
[22,]  2.0161441  0.5575513  0.26712468  0.39151615  2.24159210  2.342469814
[23,]  0.5575513  0.2671247  0.39151615  2.24159210  2.34246981  0.662377231
[24,]  0.2671247  0.3915162  2.24159210  2.34246981  0.66237723 -1.202417838
[25,]  0.3915162  2.2415921  2.34246981  0.66237723 -1.20241784  2.714028751
[26,]  2.2415921  2.3424698  0.66237723 -1.20241784  2.71402875  2.652640753
[27,]  2.3424698  0.6623772 -1.20241784  2.71402875  2.65264075  0.072190862
[28,]  0.6623772 -1.2024178  2.71402875  2.65264075  0.07219086  3.178208176
[29,] -1.2024178  2.7140288  2.65264075  0.07219086  3.17820818 -0.148590535
[30,]  2.7140288  2.6526408  0.07219086  3.17820818 -0.14859053  0.004340969

, , 3

             [,1]        [,2]        [,3]        [,4]        [,5]        [,6]        [,7]
 [1,]  0.10543738  0.57453273  0.95019575  1.82982578  2.03885442  0.97317227 -0.02784914
 [2,]  0.57453273  0.95019575  1.82982578  2.03885442  0.97317227 -0.02784914 -0.27551196
 [3,]  0.95019575  1.82982578  2.03885442  0.97317227 -0.02784914 -0.27551196  0.62333329
 [4,]  1.82982578  2.03885442  0.97317227 -0.02784914 -0.27551196  0.62333329  0.32290486
 [5,]  2.03885442  0.97317227 -0.02784914 -0.27551196  0.62333329  0.32290486 -0.15534059
 [6,]  0.97317227 -0.02784914 -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741
 [7,] -0.02784914 -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184
 [8,] -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233
 [9,]  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647
[10,]  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647  0.40200202
[11,] -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647  0.40200202  0.89936143
             [,8]        [,9]       [,10]       [,11]       [,12]       [,13]       [,14]
 [1,] -0.27551196  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233
 [2,]  0.62333329  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647
 [3,]  0.32290486 -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647  0.40200202
 [4,] -0.15534059  1.42396741  0.93474184  1.85524233 -0.37514647  0.40200202  0.89936143
 [5,]  1.42396741  0.93474184  1.85524233 -0.37514647  0.40200202  0.89936143  2.87517395
 [6,]  0.93474184  1.85524233 -0.37514647  0.40200202  0.89936143  2.87517395  1.28031078
 [7,]  1.85524233 -0.37514647  0.40200202  0.89936143  2.87517395  1.28031078  4.17265874
 [8,] -0.37514647  0.40200202  0.89936143  2.87517395  1.28031078  4.17265874  1.06568959
 [9,]  0.40200202  0.89936143  2.87517395  1.28031078  4.17265874  1.06568959  2.02299424
[10,]  0.89936143  2.87517395  1.28031078  4.17265874  1.06568959  2.02299424  1.15495435
[11,]  2.87517395  1.28031078  4.17265874  1.06568959  2.02299424  1.15495435 -0.33590265

 [ reached getOption("max.print") -- omitted 19 row(s) and 18 matrix slice(s) ]

[[2]]
 [1] -0.460651926 -0.322443414 -0.201510967 -0.270615223 -0.339719478  0.005801801 -0.218787031
 [8]  0.040353929 -0.115130647  0.057629993 -0.046026391  0.299494889  0.541359785  0.074906057
[15]  0.282218825  0.230390633  0.213114569  0.126734249 -0.236063095 -0.218787031 -0.322443414
[22] -0.322443414 -0.236063095 -0.097854583 -0.046026391 -0.391547670 -0.356995542 -0.253339159
[29] -0.374271606 -0.322443414


> val_gen = generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 501,
+     max_index = 700,
+     step = step,
+  .... [TRUNCATED] 

> test_gen <- generator(
+     data,
+     lookback = lookback,
+     delay = delay,
+     min_index = 701,
+     max_index = NULL,
+     step = step, .... [TRUNCATED] 

> # How many steps to draw from val_gen in order to see the entire validation set
> val_steps <- (701 - 501 - lookback) / batch_size

> val_steps
[1] 6.2

> # How many steps to draw from test_gen in order to see the entire test set
> test_steps <- (nrow(data) - 701 - lookback) / batch_size

> test_steps
[1] 7.366667

> model <- keras_model_sequential() %>%
+     layer_gru(units = 32,
+               input_shape = list(NULL, (dim(data)[[-1]]-1)),
+               dro .... [TRUNCATED] 

> model %>% compile(
+     optimizer = optimizer_rmsprop(),
+     loss = "mae"
+ )

> # tensorboard("logs/run_c", reload_interval = 10)
> history <- model %>% fit_generator(
+     train_gen,
+     steps_per_epoch = 200,
+     epochs = .... [TRUNCATED] 

> # plot(history)
